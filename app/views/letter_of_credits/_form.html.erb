<%= form_with(model: letter_of_credit) do |form| %>
  <%= render "shared/error_messages", resource: form.object %>

  <div class="form-group">
    <%= form.label :lc_number %>
    <%= form.text_field :lc_number, class: "form-control" %>
  </div>

  <div class="form-group">
    <%= form.label :expiry_date %>
    <%= form.text_field :expiry_date,
                        data: {
                            controller: "flatpickr",
                            flatpickr_alt_format: t("date.formats.long"),
                            flatpickr_alt_input: true,
                        }, class: "form-control" %>
  </div>

  <div class="form-group">
    <%= form.label :currency_id %>
    <%= collection_select(:letter_of_credit, :currency_id, Currency.all, :id, :code, {}, {class: "form-control"}) %>
  </div>

  <div class="form-group">
    <%= form.label :amount %>
    <%= form.text_field :amount, class: "form-control" %>
  </div>

  <div class="form-group">
    <%= form.label :client_id %>
    <%= collection_select(:letter_of_credit, :client_id, current_team.clients, :id, :name, {}, {class: "form-control"}) %>
  </div>

  <div class="form-group">
    <%= form.label :comment %>
    <%= form.text_field :comment, class: "form-control" %>
  </div>

  <div class="form-group">
    <%= form.label :files %>
    <%= form.file_field :files, accept: 'image/png,image/jpeg,application/pdf,text/plain', multiple: true, direct_upload: true, class: "form-control" %>
  </div>

  <% if @letter_of_credit.files.attached? %>
    <% @letter_of_credit.files.each do |fl| %>
      <%= form.hidden_field :files, multiple: true, value: fl.signed_id %>
    <% end %>
  <% end %>

  <div class="flex flex-row flex-wrap bg-gray-300 p-4">
    <div class="w-full text-gray-700py-1">
      <p class="px-2 py-1 uppercase text-xs">Attachments</p>
    </div>
    <div class="text-sm py-1">
      <% if @letter_of_credit.files.count == 0 %>
        <span class="bg-white rounded-full p-1 m-2 text-sm"><%= @letter_of_credit.files.count %></span>
      <% else %>
        <% @letter_of_credit.files.each do |file| %>
          <span class="mx-2"><%= link_to file.filename, file, target: :blank %></span>
          <%= link_to 'X', delete_file_attachment_letter_of_credit_url(file.signed_id),
                      method: :delete,
                      data: { confirm: 'Are you sure?' } %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="form-group flex justify-between">
    <%= form.button class: "btn btn-primary" %>

    <% if form.object.persisted? %>
      <%= link_to 'Delete', form.object, class: "btn btn-danger outline", method: :delete, data: {remote: true, confirm: "Are you sure?"} %>
    <% end %>
  </div>
<% end %>
